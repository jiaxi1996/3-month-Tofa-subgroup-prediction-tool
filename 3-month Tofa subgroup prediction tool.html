<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Tool for 3-month Tofa Treatment Outcomes in RA Patients</title>
    <style>
        /* Base typography and page styling */
        body {
            font-family: 'Times New Roman', serif;
            margin: 40px;
            background-color: #f7f7f7;
            color: #333;
            font-size: 16px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 28px;
        }
        /* Card container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px 35px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        /* Twoâ€‘column layout for form fields */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .form-group {
            flex: 1 1 calc(50% - 20px);
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        .form-group label {
            font-size: 16px;
            margin-bottom: 5px;
        }
        .form-group input,
        .form-group select {
            padding: 7px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        /* Predict button styling */
        #predictBtn {
            display: block;
            margin: 30px auto 10px;
            padding: 12px 36px;
            font-size: 18px;
            background-color: #4a8fd7;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #predictBtn:hover {
            background-color: #3e78ba;
        }
        /* Results output area */
        #result {
            text-align: center;
            margin-top: 25px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Prediction Tool for 3-month Tofa Treatment Outcomes in RA Patients</h1>
    <div class="container">
        <div class="form-group">
            <label for="outcome">Select Outcome Variable:</label>
            <select id="outcome" style="font-size:16px; padding:7px;">
                <option value="CRP">3-month DAS28CRP remission</option>
                <option value="ESR">3-month DAS28ESR remission</option>
                <option value="SDAI">3-month SDAI remission</option>
                <option value="CDAI">3-month CDAI remission</option>
            </select>
        </div>
        <!-- Input fields arranged in two columns -->
        <div class="form-row">
            <div class="form-group">
                <label for="Age(years)">Age(years):</label>
                <input type="number" id="Age(years)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Duration from diagnosis(months)">Duration from diagnosis(months):</label>
                <input type="number" id="Duration from diagnosis(months)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="BMI">BMI:</label>
                <input type="number" id="BMI" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="MTX at baseline(True=1,false=0)">MTX at baseline(True=1,false=0):</label>
                <input type="number" id="MTX at baseline(True=1,false=0)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline TJC">Baseline TJC:</label>
                <input type="number" id="Baseline TJC" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline SJC">Baseline SJC:</label>
                <input type="number" id="Baseline SJC" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline PGA(0-100)">Baseline PGA(0-100):</label>
                <input type="number" id="Baseline PGA(0-100)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline EGA(0-100)">Baseline EGA(0-100):</label>
                <input type="number" id="Baseline EGA(0-100)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline ESR(mm/h)">Baseline ESR(mm/h):</label>
                <input type="number" id="Baseline ESR(mm/h)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Baseline CRP(mg/L)">Baseline CRP(mg/L):</label>
                <input type="number" id="Baseline CRP(mg/L)" placeholder="Enter value" step="any">
            </div>
            <div class="form-group">
                <label for="Gender(Female=0,male=1)">Gender(Female=0,male=1):</label>
                <select id="Gender(Female=0,male=1)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="JAK naive(True=1,false=0)">JAK naive(True=1,false=0):</label>
                <select id="JAK naive(True=1,false=0)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Treatment naive(True=1,false=0)">Treatment naive(True=1,false=0):</label>
                <select id="Treatment naive(True=1,false=0)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Other cDMARD at baseline(True=1,false=0)">Other cDMARD at baseline(True=1,false=0):</label>
                <select id="Other cDMARD at baseline(True=1,false=0)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Prior bDMARD(True=1,false=0)">Prior bDMARD(True=1,false=0):</label>
                <select id="Prior bDMARD(True=1,false=0)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Glucocorticoid(True=1,false=0) at baseline">Glucocorticoid(True=1,false=0) at baseline:</label>
                <select id="Glucocorticoid(True=1,false=0) at baseline">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
            <div class="form-group">
                <label for="Baseline RF positive(True=1,false=0)">Baseline RF positive(True=1,false=0):</label>
                <select id="Baseline RF positive(True=1,false=0)">
                    <option value="">Select</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                </select>
            </div>
        </div>
        <button id="predictBtn">Predict</button>
        <div id="result"></div>
    </div>
    <script>
        // Model coefficients, intercepts and scaling parameters for logistic regression models
        const modelData = {
            CRP: {
                model_type: 'logistic',
                coef: [-0.3098178087754165, 0.057531243504488655, -0.02214620660757367, 0.14555037774129378, -0.47360515281005555, 0.10415136153952848, -0.07949533338902891, -0.14313487810023234, -0.010055392133512777, -0.40057335813280043, 0.5664024286605723, -0.1394299360222355, 0.42840681960241683, -0.5724906868464233, -0.4305392991954286, -0.41290318889966404, -0.16065214481787018],
                intercept: 1.093227259257224,
                continuous_means: [57.530777931381174, 87.43717125382263, 22.819051711321112, 0.5045871559633027, 6.114678899082569, 3.8256880733944953, 45.178899082568805, 41.0, 37.13302752293578, 19.022431192660548],
                continuous_scales: [14.24516881738451, 105.32345811139386, 2.9661595090184636, 0.4999789575573839, 6.618757411141188, 4.694021254290325, 22.910278024392312, 21.776175854873724, 27.15121959869372, 26.06158042722144]
            },
            ESR: {
                model_type: 'logistic',
                coef: [-0.3546707681479421, 0.009503018420708264, 0.032001120834210084, -0.16269518117442966, -0.7841877962881806, 0.33180015096764787, -0.2857395207464203, 0.2208581785249096, -0.9836050141240749, 0.2408670035200004, 1.0111991678605772, -0.3703725370020637, 0.05091563109872694, -0.4938465890531767, -0.41064867846429165, -0.13984201754755857, -0.20388472820893003],
                intercept: 0.39561496471909946,
                continuous_means: [57.530777931381174, 87.43717125382263, 22.819051711321112, 0.5045871559633027, 6.114678899082569, 3.8256880733944953, 45.178899082568805, 41.0, 37.13302752293578, 19.022431192660548],
                continuous_scales: [14.24516881738451, 105.32345811139386, 2.9661595090184636, 0.4999789575573839, 6.618757411141188, 4.694021254290325, 22.910278024392312, 21.776175854873724, 27.15121959869372, 26.06158042722144]
            },
            SDAI: {
                model_type: 'logistic',
                coef: [-0.3697243860128426, -0.12980800737701623, 0.15603145434795812, -0.23627244538700057, -0.44682398605466983, 0.30162164609612735, -0.2223913544479011, -0.24068488979030747, -0.14029643676870002, -0.5520038779072299, 0.21683113071630292, 0.6489660733976395, -0.04654502219659701, -0.5295972884491361, -0.6996969655975078, 0.33752449249980776, 0.07371605035584752],
                intercept: -1.1540395979255493,
                continuous_means: [57.530777931381174, 87.43717125382263, 22.819051711321112, 0.5045871559633027, 6.114678899082569, 3.8256880733944953, 45.178899082568805, 41.0, 37.13302752293578, 19.022431192660548],
                continuous_scales: [14.24516881738451, 105.32345811139386, 2.9661595090184636, 0.4999789575573839, 6.618757411141188, 4.694021254290325, 22.910278024392312, 21.776175854873724, 27.15121959869372, 26.06158042722144]
            },
            CDAI: {
                model_type: 'logistic',
                coef: [-0.346616032728427, -0.1334583795745322, 0.01893534909751817, -0.0948239673689141, -0.4231642131309392, 0.22670075821719712, -0.20287405943630307, -0.12440696072783149, -0.23231712857594605, -0.15771093167872016, 0.2785840044176551, 0.6160754863019954, -0.14466284496285556, -0.23510571209920533, -0.7676264975308692, 0.414176791414477, -0.052996255854665664],
                intercept: -1.1925410390831432,
                continuous_means: [57.530777931381174, 87.43717125382263, 22.819051711321112, 0.5045871559633027, 6.114678899082569, 3.8256880733944953, 45.178899082568805, 41.0, 37.13302752293578, 19.022431192660548],
                continuous_scales: [14.24516881738451, 105.32345811139386, 2.9661595090184636, 0.4999789575573839, 6.618757411141188, 4.694021254290325, 22.910278024392312, 21.776175854873724, 27.15121959869372, 26.06158042722144]
            }
        };
        // List of continuous and binary variable identifiers
        const continuousCols = [
            'Age(years)',
            'Duration from diagnosis(months)',
            'BMI',
            'MTX at baseline(True=1,false=0)',
            'Baseline TJC',
            'Baseline SJC',
            'Baseline PGA(0-100)',
            'Baseline EGA(0-100)',
            'Baseline ESR(mm/h)',
            'Baseline CRP(mg/L)'
        ];
        const binaryCols = [
            'Gender(Female=0,male=1)',
            'JAK naive(True=1,false=0)',
            'Treatment naive(True=1,false=0)',
            'Other cDMARD at baseline(True=1,false=0)',
            'Prior bDMARD(True=1,false=0)',
            'Glucocorticoid(True=1,false=0) at baseline',
            'Baseline RF positive(True=1,false=0)'
        ];
        /**
         * Standardize continuous variables and append binary variables
         * @param {Object} input - key/value pairs of raw user input
         * @param {Object} model - model entry containing scaling parameters
         * @returns {number[]} feature vector ready for prediction
         */
        function scaleFeatures(input, model) {
            const features = [];
            for (let i = 0; i < continuousCols.length; i++) {
                const col = continuousCols[i];
                const value = parseFloat(input[col]);
                const mean = model.continuous_means[i];
                const scale = model.continuous_scales[i];
                const scaled = (value - mean) / scale;
                features.push(scaled);
            }
            for (let i = 0; i < binaryCols.length; i++) {
                const col = binaryCols[i];
                const value = parseFloat(input[col]);
                features.push(value);
            }
            return features;
        }
        /**
         * Compute probability using logistic regression
         * @param {Object} model - logistic model with coef and intercept
         * @param {number[]} features - standardized feature vector
         * @returns {number} probability between 0 and 1
         */
        function predictLogistic(model, features) {
            let logit = model.intercept;
            for (let i = 0; i < model.coef.length; i++) {
                logit += model.coef[i] * features[i];
            }
            return 1 / (1 + Math.exp(-logit));
        }
        // Attach click handler for the prediction button
        document.getElementById('predictBtn').addEventListener('click', function() {
            const outcomeKey = document.getElementById('outcome').value;
            const model = modelData[outcomeKey];
            // Collect user inputs
            const inputValues = {};
            for (let col of continuousCols) {
                inputValues[col] = document.getElementById(col).value;
            }
            for (let col of binaryCols) {
                inputValues[col] = document.getElementById(col).value;
            }
            // Ensure all continuous variables are filled
            for (let col of continuousCols) {
                if (inputValues[col] === '') {
                    alert('Please enter a value for ' + col);
                    return;
                }
            }
            // Ensure all binary variables are selected
            for (let col of binaryCols) {
                if (inputValues[col] === '') {
                    alert('Please select a value for ' + col);
                    return;
                }
            }
            // Scale features and compute probability
            const features = scaleFeatures(inputValues, model);
            const prob = predictLogistic(model, features);
            const predictedClass = prob >= 0.5 ? 1 : 0;
            const probRounded = (prob * 100).toFixed(2);
            // Display output
            document.getElementById('result').innerHTML =
                'Predicted Class: ' + predictedClass + '<br>Probability of Outcome: ' + probRounded + '%';
        });
    </script>
</body>
</html>